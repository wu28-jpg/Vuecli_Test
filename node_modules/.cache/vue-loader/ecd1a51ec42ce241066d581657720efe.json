{"remainingRequest":"C:\\Users\\tangt\\Documents\\HBuilderProjects\\Vuecli_Test\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\tangt\\Documents\\HBuilderProjects\\Vuecli_Test\\src\\components\\rlsbTest.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\tangt\\Documents\\HBuilderProjects\\Vuecli_Test\\src\\components\\rlsbTest.vue","mtime":1655204098883},{"path":"C:\\Users\\tangt\\Documents\\HBuilderProjects\\Vuecli_Test\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1654650351657},{"path":"C:\\Users\\tangt\\Documents\\HBuilderProjects\\Vuecli_Test\\node_modules\\babel-loader\\lib\\index.js","mtime":1654650367372},{"path":"C:\\Users\\tangt\\Documents\\HBuilderProjects\\Vuecli_Test\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1654650351657},{"path":"C:\\Users\\tangt\\Documents\\HBuilderProjects\\Vuecli_Test\\node_modules\\vue-loader\\lib\\index.js","mtime":1654650364246}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n // import tracking from '@/assets/tracking.js-master/build/tracking-min.js';\n  // import '@/assets/tracking.js-master/build/data/face-min.js';\n \n  export default {\n    data() {\n      return {\n        video: null,\n        screenshotCanvas: null,\n        uploadLock: true // 上传锁\n      }\n    },\n    mounted() {\n      this.init();\n    },\n    methods: {\n      // 初始化设置\n      init() {\n        this.video = document.getElementById('video');\n        this.screenshotCanvas = document.getElementById('screenshotCanvas');\n \n        let canvas = document.getElementById('canvas');\n        let context = canvas.getContext('2d');\n \n        // 固定写法\n        let tracker = new window.tracking.ObjectTracker('face');\n        tracker.setInitialScale(4);\n        tracker.setStepSize(2);\n        tracker.setEdgesDensity(0.1);\n        window.tracking.track('#video', tracker, {\n          camera: true\n        });\n \n        let _this = this;\n        tracker.on('track', function(event) {\n \n          // 检测出人脸 绘画人脸位置\n          context.clearRect(0, 0, canvas.width, canvas.height);\n          event.data.forEach(function(rect) {\n            context.strokeStyle = '#0764B7';\n            context.strokeRect(rect.x, rect.y, rect.width, rect.height);\n \n            // 上传图片\n            _this.uploadLock && _this.screenshotAndUpload();\n          });\n        });\n      },\n      // 上传图片\n      screenshotAndUpload() {\n        // 上锁避免重复发送请求\n        this.uploadLock = false;\n \n        // 绘制当前帧图片转换为base64格式\n        let canvas = this.screenshotCanvas;\n        let video = this.video;\n        let ctx = canvas.getContext('2d');\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n        let base64Img = canvas.toDataURL('image/jpeg');\n \n        // 使用 base64Img 请求接口即可\n        console.log('base64Img:',base64Img)\n \n        // 请求接口成功以后打开锁\n        // this.uploadLock = true;\n      }\n    }\n  }\n\n",{"version":3,"sources":["rlsbTest.vue"],"names":[],"mappings":";;;;;;;;;;;;AAYA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"rlsbTest.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n\t<div>\r\n\t    <div class=\"video-box\">\r\n\t      <video id=\"video\" width=\"320\" height=\"240\" preload autoplay loop muted></video>\r\n\t      <canvas id=\"canvas\" width=\"320\" height=\"240\"></canvas>\r\n\t    </div>\r\n\t    <canvas id=\"screenshotCanvas\" width=\"320\" height=\"240\"></canvas>\r\n\t  </div>\r\n\n</template>\n\n<script>\r\n\t // import tracking from '@/assets/tracking.js-master/build/tracking-min.js';\r\n\t  // import '@/assets/tracking.js-master/build/data/face-min.js';\r\n\t \r\n\t  export default {\r\n\t    data() {\r\n\t      return {\r\n\t        video: null,\r\n\t        screenshotCanvas: null,\r\n\t        uploadLock: true // 上传锁\r\n\t      }\r\n\t    },\r\n\t    mounted() {\r\n\t      this.init();\r\n\t    },\r\n\t    methods: {\r\n\t      // 初始化设置\r\n\t      init() {\r\n\t        this.video = document.getElementById('video');\r\n\t        this.screenshotCanvas = document.getElementById('screenshotCanvas');\r\n\t \r\n\t        let canvas = document.getElementById('canvas');\r\n\t        let context = canvas.getContext('2d');\r\n\t \r\n\t        // 固定写法\r\n\t        let tracker = new window.tracking.ObjectTracker('face');\r\n\t        tracker.setInitialScale(4);\r\n\t        tracker.setStepSize(2);\r\n\t        tracker.setEdgesDensity(0.1);\r\n\t        window.tracking.track('#video', tracker, {\r\n\t          camera: true\r\n\t        });\r\n\t \r\n\t        let _this = this;\r\n\t        tracker.on('track', function(event) {\r\n\t \r\n\t          // 检测出人脸 绘画人脸位置\r\n\t          context.clearRect(0, 0, canvas.width, canvas.height);\r\n\t          event.data.forEach(function(rect) {\r\n\t            context.strokeStyle = '#0764B7';\r\n\t            context.strokeRect(rect.x, rect.y, rect.width, rect.height);\r\n\t \r\n\t            // 上传图片\r\n\t            _this.uploadLock && _this.screenshotAndUpload();\r\n\t          });\r\n\t        });\r\n\t      },\r\n\t      // 上传图片\r\n\t      screenshotAndUpload() {\r\n\t        // 上锁避免重复发送请求\r\n\t        this.uploadLock = false;\r\n\t \r\n\t        // 绘制当前帧图片转换为base64格式\r\n\t        let canvas = this.screenshotCanvas;\r\n\t        let video = this.video;\r\n\t        let ctx = canvas.getContext('2d');\r\n\t        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\t        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\t        let base64Img = canvas.toDataURL('image/jpeg');\r\n\t \r\n\t        // 使用 base64Img 请求接口即可\r\n\t        console.log('base64Img:',base64Img)\r\n\t \r\n\t        // 请求接口成功以后打开锁\r\n\t        // this.uploadLock = true;\r\n\t      }\r\n\t    }\r\n\t  }\r\n\t\n</script>\n\n<style>\r\n\t#screenshotCanvas{\r\n\t    display: none;\r\n\t  }\r\n\t \r\n\t  .video-box{\r\n\t    position: relative;\r\n\t    width: 320px;\r\n\t    height: 240px;\r\n\t  }\r\n\t  \r\n\t  \r\n\t  video,canvas{\r\n\t    position: absolute;\r\n\t    top: 0;\r\n\t    left: 0;\r\n\t\tborder: #000000 5px solid;\r\n\t  }\n</style>"]}]}